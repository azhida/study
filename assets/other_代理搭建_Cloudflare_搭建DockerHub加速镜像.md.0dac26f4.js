import{_ as s,o as a,c as n,Q as l}from"./chunks/framework.aaef0e9b.js";const A=JSON.parse('{"title":"搭建 DockerHub 加速镜像","description":"","frontmatter":{},"headers":[],"relativePath":"other/代理搭建/Cloudflare/搭建DockerHub加速镜像.md","lastUpdated":1714039687000}'),o={name:"other/代理搭建/Cloudflare/搭建DockerHub加速镜像.md"},p=l(`<h1 id="搭建-dockerhub-加速镜像" tabindex="-1">搭建 DockerHub 加速镜像 <a class="header-anchor" href="#搭建-dockerhub-加速镜像" aria-label="Permalink to &quot;搭建 DockerHub 加速镜像&quot;">​</a></h1><h2 id="解析一个二级域名" tabindex="-1">解析一个二级域名 <a class="header-anchor" href="#解析一个二级域名" aria-label="Permalink to &quot;解析一个二级域名&quot;">​</a></h2><p><code>docker-hub.demo.cn</code> 是我们要制作的github镜像的访问地址。</p><ul><li>进入域名 <code>demo.cn</code> 下操作</li><li>点击 <code>DNS/Records</code></li><li>点击 <code>Add record</code> , 填上对应参数 <ul><li>Type：A</li><li>Name： docker-hub</li><li>IPv4 address：随便填一个有效的 ip 地址即可，因为不会真的解析到这个地址(可以直接在百度输入 ip 拿到当前 ip)</li></ul></li><li>点击 <code>Save</code></li></ul><h2 id="创建一个-worker" tabindex="-1">创建一个 Worker <a class="header-anchor" href="#创建一个-worker" aria-label="Permalink to &quot;创建一个 Worker&quot;">​</a></h2><ul><li>点击 <code>Workers &amp; Pages/Overview</code></li><li>点击 <code>Create an application</code></li><li>点击 <code>Workers/Create Worker</code></li><li>在创建 Worker 页面填写 Name 为 <code>docker-hub</code> ，然后点击 <code>Deploy</code></li><li>进入 Worker 信息页面，点击 <code>Edit Code</code> 编写代码</li><li>代码如下</li></ul><p>worker.js</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#BABED8;"> TELEGRAPH_URL </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">hub.docker.com</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#82AAFF;">addEventListener</span><span style="color:#BABED8;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">fetch</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">event</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">event</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">respondWith</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">handleRequest</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">event</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">request</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#BABED8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">async</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">function</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">handleRequest</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">request</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">url</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">URL</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">request</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">url</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">url</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">host</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">TELEGRAPH_URL</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;font-style:italic;">^</span><span style="color:#C3E88D;">https</span><span style="color:#89DDFF;">?</span><span style="color:#C3E88D;">:</span><span style="color:#BABED8;">\\/\\/</span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">modifiedRequest</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Request</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">url</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    headers</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">request</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">headers</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    method</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">request</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">method</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    body</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">request</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">body</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    redirect</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">follow</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">response</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">fetch</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">modifiedRequest</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">modifiedResponse</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Response</span><span style="color:#F07178;">(</span><span style="color:#BABED8;">response</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">body</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">response</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;font-style:italic;">// 添加允许跨域访问的响应头</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#BABED8;">modifiedResponse</span><span style="color:#89DDFF;">.</span><span style="color:#BABED8;">headers</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">Access-Control-Allow-Origin</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">*</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#BABED8;">modifiedResponse</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><ul><li>点击 右上角按钮 <code>Deploy</code> ，保存并发布</li><li>回到 Worker 信息页面</li><li>点击 <code>Setting/Triggers</code></li><li>点击 <code>Add route</code>，填上如下信息 <ul><li>Route：<code>*.demo.cn/*</code> 或者 <code>*docker-hub.demo.cn/*</code></li><li>Zone：<code>demo.cn</code></li><li>点击 <code>Add route</code> 确认保存</li></ul></li></ul><h2 id="访问镜像地址" tabindex="-1">访问镜像地址 <a class="header-anchor" href="#访问镜像地址" aria-label="Permalink to &quot;访问镜像地址&quot;">​</a></h2><p><a href="https://docker-hub.demo.cn" target="_blank" rel="noreferrer">DockerHub 镜像地址</a></p><p>到此，访问应该成功了！</p><h2 id="注意" tabindex="-1">注意 <a class="header-anchor" href="#注意" aria-label="Permalink to &quot;注意&quot;">​</a></h2><ul><li>镜像不支持登录注册。</li></ul><h2 id="参考" tabindex="-1">参考 <a class="header-anchor" href="#参考" aria-label="Permalink to &quot;参考&quot;">​</a></h2><p><a href="https://zhuanlan.zhihu.com/p/687822231" target="_blank" rel="noreferrer">用Cloudflare搭建Github加速镜像</a></p>`,16),e=[p];function c(r,t,F,y,D,i){return a(),n("div",null,e)}const B=s(o,[["render",c]]);export{A as __pageData,B as default};
