import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.aaef0e9b.js";const B=JSON.parse('{"title":"用 Python 爬取股票实时数据","description":"","frontmatter":{},"headers":[],"relativePath":"server/python/爬虫/股票数据/东方财富网.md","lastUpdated":1684469696000}'),p={name:"server/python/爬虫/股票数据/东方财富网.md"},o=l(`<h1 id="用-python-爬取股票实时数据" tabindex="-1">用 Python 爬取股票实时数据 <a class="header-anchor" href="#用-python-爬取股票实时数据" aria-label="Permalink to &quot;用 Python 爬取股票实时数据&quot;">​</a></h1><div class="language-py"><button title="Copy Code" class="copy"></button><span class="lang">py</span><pre class="shiki material-theme-palenight has-diff"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> requests</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> json</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#BABED8;"> os</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 单个页面请求</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># json_url = &quot;http://48.push2.eastmoney.com/api/qt/clist/get?cb=jQuery112402508937289440778_1658838703304&amp;pn=1&amp;pz=20&amp;po=1&amp;np=1&amp;ut=bd1d9ddb04089700cf9c27f6f7426281&amp;fltt=2&amp;invt=2&amp;wbp2u=|0|0|0|web&amp;fid=f3&amp;fs=m:0+t:6,m:0+t:80,m:1+t:2,m:1+t:23,m:0+t:81+s:2048&amp;fields=f1,f2,f3,f4,f5,f6,f7,f8,f9,f10,f12,f13,f14,f15,f16,f17,f18,f20,f21,f23,f24,f25,f22,f11,f62,f128,f136,f115,f152&amp;_=1658838703305&quot;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># res = requests.get(json_url)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># result = res.text.split(&quot;jQuery112402508937289440778_1658838703304&quot;)[1].split(&quot;(&quot;)[1].split(&quot;);&quot;)[0]</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># result_json = json.loads(result)</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># print(result_json)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># 股票数据都在data.diff下面</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">def</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">save_data</span><span style="color:#89DDFF;">(</span><span style="color:#BABED8;font-style:italic;">data</span><span style="color:#89DDFF;">,</span><span style="color:#BABED8;"> </span><span style="color:#BABED8;font-style:italic;">date</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#BABED8;">    file_name </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#C792EA;">r</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">data/stock_data_%s.csv</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">%</span><span style="color:#BABED8;"> date</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    file_exists </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">True</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">not</span><span style="color:#BABED8;"> os</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">exists</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">file_name</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#BABED8;">        file_exists </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">False</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#89DDFF;font-style:italic;">with</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">open</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">file_name</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">a+</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#BABED8;font-style:italic;">encoding</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;font-style:italic;">as</span><span style="color:#BABED8;"> f</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">not</span><span style="color:#BABED8;"> file_exists</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">            f</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">write</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">股票代码,股票名称,最新价,涨跌幅,涨跌额,成交量（手）,成交额,振幅,换手率,市盈率,量比,最高,最低,今开,昨收,市净率</span><span style="color:#BABED8;">\\n</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#BABED8;">        </span><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#BABED8;"> i </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#BABED8;"> data</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#BABED8;">            Code </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> i</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">f12</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">            Name </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> i</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">f14</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">            Close </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> i</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">f2</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">            ChangePercent </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> i</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">f3</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">            Change </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> i</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">f4</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">            Volume </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> i</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">f5</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">            Amount </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> i</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">f6</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">            Amplitude </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> i</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">f7</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">            TurnoverRate </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> i</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">f8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">            PERation </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> i</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">f9</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">            VolumeRate </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> i</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">f10</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">            Hign </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> i</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">f15</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">            Low </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> i</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">f16</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">            Open </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> i</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">f17</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">            PreviousClose </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> i</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">f18</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">            PB </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> i</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">f22</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">            row </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#F78C6C;">{}</span><span style="color:#C3E88D;">,</span><span style="color:#F78C6C;">{}</span><span style="color:#C3E88D;">,</span><span style="color:#F78C6C;">{}</span><span style="color:#C3E88D;">,</span><span style="color:#F78C6C;">{}</span><span style="color:#C3E88D;">,</span><span style="color:#F78C6C;">{}</span><span style="color:#C3E88D;">,</span><span style="color:#F78C6C;">{}</span><span style="color:#C3E88D;">,</span><span style="color:#F78C6C;">{}</span><span style="color:#C3E88D;">,</span><span style="color:#F78C6C;">{}</span><span style="color:#C3E88D;">,</span><span style="color:#F78C6C;">{}</span><span style="color:#C3E88D;">,</span><span style="color:#F78C6C;">{}</span><span style="color:#C3E88D;">,</span><span style="color:#F78C6C;">{}</span><span style="color:#C3E88D;">,</span><span style="color:#F78C6C;">{}</span><span style="color:#C3E88D;">,</span><span style="color:#F78C6C;">{}</span><span style="color:#C3E88D;">,</span><span style="color:#F78C6C;">{}</span><span style="color:#C3E88D;">,</span><span style="color:#F78C6C;">{}</span><span style="color:#C3E88D;">,</span><span style="color:#F78C6C;">{}</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">format</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#82AAFF;">                Code</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">Name</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">Close</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">ChangePercent</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">Change</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">Volume</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">Amount</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">Amplitude</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#82AAFF;">                TurnoverRate</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">PERation</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">VolumeRate</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">Hign</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">Low</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">Open</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">PreviousClose</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;">PB</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">            f</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">write</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">row</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">            f</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">write</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#BABED8;">\\n</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">        </span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#BABED8;"> i </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#BABED8;"> </span><span style="color:#82AAFF;">range</span><span style="color:#89DDFF;">(</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#F78C6C;">100</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">抓取网页</span><span style="color:#F78C6C;">%s</span><span style="color:#89DDFF;">&quot;</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">%</span><span style="color:#82AAFF;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">i</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#BABED8;">    url </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">http://48.push2.eastmoney.com/api/qt/clist/get?cb=jQuery112402508937289440778_1658838703304&amp;pn=</span><span style="color:#F78C6C;">%s</span><span style="color:#C3E88D;">&amp;pz=20&amp;po=1&amp;np=1&amp;ut=bd1d9ddb04089700cf9c27f6f7426281&amp;fltt=2&amp;invt=2&amp;wbp2u=|0|0|0|web&amp;fid=f3&amp;fs=m:0+t:6,m:0+t:80,m:1+t:2,m:1+t:23,m:0+t:81+s:2048&amp;fields=f1,f2,f3,f4,f5,f6,f7,f8,f9,f10,f12,f13,f14,f15,f16,f17,f18,f20,f21,f23,f24,f25,f22,f11,f62,f128,f136,f115,f152&amp;_=1658838703305</span><span style="color:#89DDFF;">&quot;</span><span style="color:#BABED8;"> </span><span style="color:#89DDFF;">%</span><span style="color:#BABED8;"> </span><span style="color:#FFCB6B;">str</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">i</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    res </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> requests</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">url</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    result </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> res</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">text</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">split</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">jQuery112402508937289440778_1658838703304</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">].</span><span style="color:#82AAFF;">split</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)[</span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">].</span><span style="color:#82AAFF;">split</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">);</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">)[</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    result_json </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> json</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">loads</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">result</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    stock_data </span><span style="color:#89DDFF;">=</span><span style="color:#BABED8;"> result_json</span><span style="color:#89DDFF;">[</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">data</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">][</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">diff</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">]</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">stock_data</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#82AAFF;">print</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">stock_data</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#BABED8;">    </span><span style="color:#82AAFF;">save_data</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">stock_data</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">2023-05-19</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">)</span></span></code></pre></div>`,2),t=[o];function e(D,c,F,r,y,i){return n(),a("div",null,t)}const E=s(p,[["render",e]]);export{B as __pageData,E as default};
