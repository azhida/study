# 自动化测试-环境安装

Python+Appium+夜神模拟器

## 安装 Java JDK

下载页面： https://www.oracle.com/cn/java/technologies/downloads/#sjre8-windows

下载地址： https://www.oracle.com/cn/java/technologies/downloads/#license-lightbox
 
 - 配置 环境变量/系统变量

`JAVA_HOME`: `C:\ruanjian\Java\jre-1.8`

`path` 添加： `C:\ruanjian\Java\jre-1.8\bin`

- 检测 java 环境

新开 cmd 输入
```
java -version
```

输出
```
java version "1.8.0_371"
Java(TM) SE Runtime Environment (build 1.8.0_371-b11)
Java HotSpot(TM) 64-Bit Server VM (build 25.371-b11, mixed mode)
```

## 安装 Android SDK

官网： https://www.androiddevtools.cn/

下载地址： 

`exe`: https://dl.google.com/android/installer_r24.4.1-windows.exe?utm_source=androiddevtools&utm_medium=website

`zip`: https://dl.google.com/android/android-sdk_r24.4.1-windows.zip?utm_source=androiddevtools&utm_medium=website

- 环境变量

`ANDROID_HOME`: `D:\ruanjian\android-sdk-windows`

`path` 添加：
```
D:\ruanjian\android-sdk-windows\platform-tools
D:\ruanjian\android-sdk-windows\tools
```

- 下载相关包

点击 `D:\ruanjian\android-sdk-windows\SDK Manager.exe`

## 安装 pycharm

直接在 pycharm 里面做 python 环境即可

pycharm 下载地址： https://www.jetbrains.com/pycharm/download/#section=windows

Community 社区版免费！


## 安装 Appium

使用appium-desktop来搭建Appium-Server环境；appium-desktop是连接appium服务的桌面应用，可以方便测试人员进行连接手机，录制脚本等工作。

https://github.com/appium/appium-desktop/releases

下载 [Appium-Server-GUI-windows-1.22.3-4.exe](https://github.com/appium/appium-desktop/releases/download/v1.22.3-4/Appium-Server-GUI-windows-1.22.3-4.exe)

- 点击 `Edit Configurations` 进行基础配置
	1. `ANDROID_HOME`: `D:\ruanjian\android-sdk-windows`
	2. `JAVA_HOME`: `C:\ruanjian\Java\jre-1.8`


### 配置 Appium desktop

参考：
[Appium app自动化测试环境搭建完整版（内网）](https://www.jianshu.com/p/2d48cca6e620?utm_campaign=maleskine&utm_content=note&utm_medium=seo_notes&utm_source=recommendation)

Appium 服务启动后，在 主页面 点击 三个按钮中类似 搜索图标 的按钮，进入 配置页面

- 配置 `Desired Capabilities` 项

```json
{
  "automationName": "appium", // 自动化方案名称(固定 appium)
  "platformName": "Android", // 平台：Android 或 ios 
  "platformVersion": "7.1.2", // 平台系统版本：此处 Android7.1.2
  "deviceName": "127.0.0.1:62001 device", // 连接的 adb 
  "appPackage": "com.douguo.recipe", // 应用包名
  "appActivity": "com.douguo.recipe/.MainActivity", // 应用启动页
  "autoAcceptAlerts": "true", // 对权限弹窗进行授权
  "app": "D:\\ruanjian\\apps\\dgms.apk" // 应用 apk 地址
}
```



- 查看安卓版本号
```
adb shell getprop ro.build.version.release
```

- 查看连接的 adb 
```
adb devices
```

- 查看包名
```
aapt dump badging D:\ruanjian\apps\dgms.apk
```
- 查看应用启动页
```
adb shell monkey -p com.douguo.recipe -v -v -v 1 | findstr "cmp="
```


## 安装 夜神模拟器

- 官网

https://www.yeshen.com/

- 安装路径

```
D:\Program Files\Nox
```

- 用 安卓 SDK 的 `adb` 替换 夜神模拟器的 `adb`

安卓 SDK adb ： `D:\ruanjian\android-sdk-windows\platform-tools\adb.exe`

夜神模拟器的 `adb` :
- `D:\Program Files\Nox\bin\adb.exe`
- `D:\Program Files\Nox\bin\nox_adb.exe`

```
cp D:\ruanjian\android-sdk-windows\platform-tools\adb.exe D:\Program Files\Nox\bin\adb.exe
cp D:\ruanjian\android-sdk-windows\platform-tools\adb.exe D:\Program Files\Nox\bin\nox_adb.exe
```

- 检测 adb 是否连接成功
```
adb devices
```
成功会输出如下：
```
List of devices attached
127.0.0.1:62001 device
```

## 安装 Appium-Python-Client

appium-desktop 和 模拟机 连接时，可以通过录制，进行操作模拟机，然后，把录制脚本转化为正式python脚本，可以复制到pycharm编辑器中，通过appium-python-client这个驱动来自动化模拟机。脚本在pycharm中运行，通过appium-server来操作模拟机。

python 环境下执行：
```
pip install Appium-Python-Client 
```


## 参考

[Python+Appium+夜神模拟器 全流程从环境搭建到实现自动化（APP自动化）](https://blog.csdn.net/L_980317/article/details/128076185)

[Appium app自动化测试环境搭建完整版（内网）](https://www.jianshu.com/p/2d48cca6e620?utm_campaign=maleskine&utm_content=note&utm_medium=seo_notes&utm_source=recommendation)