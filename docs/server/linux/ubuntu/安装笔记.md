# ubuntu server 20.04 安装笔记

[学习地址：https://www.osyunwei.com/?p=10727](https://www.osyunwei.com/?p=10727)

## 开启root账号
```
# 启用root账号并设置密码，根据提示输入2次密码
sudo passwd root

# 从普通用户切换到root用户，根据提示输入root密码
su root

# 禁用root账号，如果要启用，输入sudo passwd root再次设置root密码
sudo passwd -l root

# 创建一个普通用户
adduser osyunwei

# 关机，不加参数-p会进入休眠状态，卡在关机界面
halt -p
```
## 设置IP地址、网关、DNS 
>如果安装时已经连上了，可以不用再配

Ubuntu Server17.10 开始，弃用 `/etc/network/interfaces` 配置文件，改成 netplan ⽅式。

各个版本配置文件
```
# Ubuntu Server17.10 以前
/etc/network/interfaces

# Ubuntu Server 18.04
/etc/netplan/01-netcfg.yaml

# Ubuntu Server 20.04
/etc/netplan/00-installer-config.yaml
```
- 修改配置文件
```
vim /etc/netplan/00-installer-config.yaml
```
```
# This is the network config written by 'subiquity'
network:
    ethernets:    
        ens33:        
            dhcp4: no            
            addresses: [192.168.21.204/24]            
            gateway4: 192.168.21.2            
            nameservers:            
                addresses: [8.8.8.8]                
                addresses: [8.8.4.4]    
    version: 2
```
> 注意：yaml格式是层级的，配置文件有上下级关系，需要缩进，冒号后面的配置文件一定要空一格再写，否则配置出错。
- 重启，使配置文件生效，如果配置失败，请仔细检查配置文件，注意格式和空格
```
netplan apply
```

## 注：

使用了系统默认的磁盘分区，LVM 磁盘管理。
硬盘信息：500G SSD + 3T 机械硬盘。
用 `df -h` 看不到 3T 的硬盘信息。
解决如下：

### 磁盘操作相关

```
# 查看磁盘信息，找到 3T 的磁盘信息，如： /dev/sda1
fdisk -l
# /dev/sda1   2048 7814035455 7814033408  3.7T Microsoft basic data

# 显示存在的卷组，看 卷组名字和剩余可分配的空间 Free PE/Size
vgdisplay
# VG Name               ubuntu-vg
# Free  PE / Size       0 / 0

# 把 3T硬盘空间 添加到 卷组 ubuntu-vg ，再执行 vgdisplay 就可以看到 Free 有剩余的空间了
vgextend ubuntu-vg /dev/sda1

# 查看磁盘目录和挂载点
df -h
# /dev/mapper/ubuntu--vg-ubuntu--lv  4.1T  298G  3.6T   8% /

# 用以下方式 全部空间都给这个盘 /dev/mapper/ubuntu--vg-ubuntu--lv
lvextend -l +100%FREE /dev/mapper/ubuntu–vg-ubuntu–lv

# 然后重新计算磁盘大小
resize2fs /dev/mapper/ubuntu–vg-ubuntu–lv

# 再次查看磁盘情况，就可以看到 空间扩大了
df -h
```



